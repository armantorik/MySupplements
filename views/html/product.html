<html>

<body id="root">
  <p>
    Product Page:
  </p>
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js" defer></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>

<script>

  const url = window.location.search;
  const pid = new URLSearchParams(url).get('pid');
  var purl = "/api/products/" + pid;

  fetch(purl).then((response) => {
    return response.json();  // converting byte data to json
  }).then(data => {

    var product = data["jsonObject"]["detail"][0];
    var imgLink = product["link"];
    var pname = product["name"];
    var info = product["info"];
    var quantity = product["quantity"];

    var price = product["price"];
    document.getElementById("root").innerHTML += "<th>" + pname + "</th> <p>" + info + "</p><img width='200' height='200' src=" + imgLink + "></img><p> Quantity: " + quantity + "</p> <p> Price: " + price + "</p>";
  });
</script>

<button onclick="addbasket()" class="add-to-cart" type="button" id="add-to-cart">ADD TO CART</button>
<li class="cart">
  <a href="html/cart.html">
    Cart
  </a>
</li>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyBXC-zH_VU7hjRYuRoA-DoizGN8ndGIJ8M",
    authDomain: "ecommerce-ca57f.firebaseapp.com",
    databaseURL: "https://ecommerce-ca57f-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "ecommerce-ca57f",
    storageBucket: "ecommerce-ca57f.appspot.com",
    messagingSenderId: "450193218046",
    appId: "1:450193218046:web:ed740c91c94096998288af",
    measurementId: "G-SV0VSC22KY"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);

  function addbasket() {
    const url = window.location.search;
    const pid = new URLSearchParams(url).get('pid');
    console.log("hello");
    firebase.auth().onAuthStateChanged(user => {

      if (user) {
        console.log(firebase.auth().currentUser.email);
        var queryurl = "/api/add2basket?&email=" + firebase.auth().currentUser.email + "&pid=" + pid;

        axios.put(queryurl).then(
          (response) => {
            var result = response.data;
            console.log('Processing Request');
            resolve(result);

          },
          (error) => {
            reject(error);
          }
        );
      }
      else {
        console.log("no user");
      }
    });
  };



</script>

</html>